# STORAGE-FOR-ALL-THINGS
"Универсальный каталог" - это способ записывать и читать произвольные
данные в структурированном виде, без необходимости управлять
структурой данных. 

"Универсальный каталог" это библиотека для управления данными
записанными с использованием паттерна EAV (Entity Attribute Value).

Пользователь получает возможность выполнять поисковые и аналитические
запросы к данным, всё остальное делает "Каталог".

"Каталог" автоматически управляет структурой данных, обеспечивает
высокую скорость доступа к данным. Пользователь только добавляет
данные и выполняет запросы.

Всё просто. Приятного использования.

## Установка библиотеки
Вы можете установить библиотеку в свой PHP проект как зависимость
Composer:
```bash
composer require sbwerewolf/eav-manager
```

## Оглавление
- [Польза от библиотеки](/readme.md)
- [Бизнес логика в общих словах](/inner-workings.md)

## Преимущества проекта "Универсальный каталог"

### Преимущества EAV

EAV - Entity Attribute Value - Сущность Атрибут Значение - это модель
данных, которая позволяет создавать "таблицы" БД с произвольным
набором "колонок". При этом нет необходимости создавать новые объекты
БД.

Таким образом для каждой сущности ("таблицы") можно иметь произвольный
состав атрибутов ("колонок"), за счёт этого, EAV даёт возможность
работы с произвольными данными без вмешательства разработчиков.

### Недостатки EAV

Обычный способ использования EAV это построение представления общего
для всех сущностей. Это приводит к тому что при увеличении количества
сущностей и атрибутов, увеличивается объём данных по которым
выполняется поиск, что приводит к увеличению времени поиска

### Как "Универсальный каталог" устраняет недостатки EAV

"Универсальный каталог" устраняет недостатки EAV, за счёт того что
каждая сущность храниться в отдельной таблице или материализованном
представлении. 

Все выборки данных выполняются не по таблицам EAV, а по данным
вынесенным в отдельный объект БД.

---

**СКОРОСТЬ РАБОТЫ С ДАННЫМИ СОХРАНЯЕТСЯ НЕ ЗАВИСИМО ОТ КОЛИЧЕСТВА
СУЩНОСТЕЙ И АТРИБУТОВ.**

---

"Универсальный каталог" сохраняет гибкость и простоту в управлении
атрибутивным составом данных, при этом скорость работы ни чем не
отличается от работы с обычными таблицами.

Мастер данные сохраняются в таблицах EAV. Это даёт
возможность в любой момент времени изменить формат хранилища для
отдельной сущности, перейти на работу через таблицу БД или через
материализованное представление.

В будущем будет добавлена поддержка хранилища в формате JSONB.

## Как развернуть
1. Создать базу данных в СУБД PostgreSQL 9+ ;
2. Подключиться к СУБД и созданной БД;
3. Выполнить скрипт `configuration/install-tables.sql.example`, в
БД будут созданы таблицы необходимые для хранения данных;
4. Создать пользователя для работы с БД от имени библиотеки; 
5. Пользователь должен иметь права на создание представлений,
материализованных представлений и таблиц, соответственно на CRUD
операции;

### Как проверить работоспособность
Библиотека для работы с СУБД использует PDO. Тесты используют
реквизиты подключения к СУБД из файла
`корень библиотеки/configuration/pdo.env`.

Соответственно для запуска тестов вам необходимо создать файл с этим
именем и расположенный по этому пути. Либо можно заменить в тестах
строки реализующие создание подключения:
```php
        $pathParts = [
            __DIR__,
            '..',
            '..',
            'configuration',
            'pdo.env',
        ];
        $path = implode(DIRECTORY_SEPARATOR, $pathParts);
        $linkToData = (new PdoConnection($path))->get();
```
на примерно такой код:
```php
        $linkToData = new PDO('pgsql:dbname=all_things;host=localhost');
```
Если вы решите создать собственный конфигурационный файл
(`configuration/pdo.env`), то за основу можно взять
`configuration/pdo.env.example`.

## Услуги (варианты использования)

### Основные услуги

- S002 Выполнить поиск элементов каталога по заданным характеристикам
- S003 Выполнить быстрый поиск

### Дополнительные услуги

- S001 Создать модель (предмет) с произвольными характеристиками
- S004 Выполнить быстрое обновление
- E005 Создать структуру для быстрого поиска
- E006 Обновить данные для быстрого поиска
- E007 Создать структуру для быстрого обновления

## Дополнительные материалы

Для демонстрации работы с каталогом разработан
[тест](/tests/Integration/AutomatedProcessTest.php) по комментариям в
коде можно понять как работать с библиотекой.

При зависимостях установленных в режиме разработчика, тест можно
запустить командой:
```bash
composer test
```

Комплексные операции с данными удобно выполнять с помощью 
[Менеджера EAV](src/AllThings/ControlPanel/Manager.php).

Для генерации случайного набора данных написан скрипт
`data-generator/generate.php`.

Для замера производительности написан скрипт
`data-generator/benchmark.php`, с выводом среднего времени выполнения
по каждой операции с данными.

`benchmark.php` это в том числе и пример использования библиотеки.

Если у вас есть вопросы или вы хотите принять участие в разработке, то
мои контакты указаны ниже.

## Контакты
```
Вольхин Николай
e-mail ulfnew@gmail.com
phone +7-902-272-65-35
Telegram @sbwerewolf
```

[Telegram chat with me](https://t.me/SbWereWolf) 
